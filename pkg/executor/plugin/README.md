<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# plugin

```go
import "go.bonk.build/pkg/executor/plugin"
```

Package plugin provides an executor which uses go\-plugin to launch gRPC subprocesses.

## Index

- [type Plugin](<#Plugin>)
  - [func NewPlugin\(name string, initializers ...PluginOption\) \*Plugin](<#NewPlugin>)
  - [func \(p \*Plugin\) Execute\(ctx context.Context, session task.Session, tsk \*task.Task, res \*task.Result\) error](<#Plugin.Execute>)
  - [func \(\*Plugin\) GRPCClient\(context.Context, \*goplugin.GRPCBroker, \*grpc.ClientConn\) \(any, error\)](<#Plugin.GRPCClient>)
  - [func \(p \*Plugin\) GRPCServer\(\_ \*goplugin.GRPCBroker, server \*grpc.Server\) error](<#Plugin.GRPCServer>)
  - [func \(p \*Plugin\) Name\(\) string](<#Plugin.Name>)
  - [func \(p \*Plugin\) Serve\(\)](<#Plugin.Serve>)
  - [func \(plugin \*Plugin\) ServeTest\(t \*testing.T\) executor.Executor](<#Plugin.ServeTest>)
- [type PluginClient](<#PluginClient>)
  - [func NewPluginClient\(ctx context.Context, goCmdPath string\) \(\*PluginClient, error\)](<#NewPluginClient>)
  - [func \(plugin \*PluginClient\) Shutdown\(\)](<#PluginClient.Shutdown>)
- [type PluginClientManager](<#PluginClientManager>)
  - [func NewPluginClientManager\(\) PluginClientManager](<#NewPluginClientManager>)
- [type PluginOption](<#PluginOption>)
  - [func WithExecutor\[Params any\]\(name string, exec argconv.TypedExecutor\[Params\]\) PluginOption](<#WithExecutor>)


<a name="Plugin"></a>
## type [Plugin](<server.go#L28-L33>)

Plugin describes a plugin and the services it provides.

```go
type Plugin struct {
    router.Router
    goplugin.NetRPCUnsupportedPlugin
    // contains filtered or unexported fields
}
```

<a name="NewPlugin"></a>
### func [NewPlugin](<server.go#L44>)

```go
func NewPlugin(name string, initializers ...PluginOption) *Plugin
```

NewPlugin creates a new [Plugin](<#Plugin>) from the given options.

<a name="Plugin.Execute"></a>
### func \(\*Plugin\) [Execute](<server.go#L97-L102>)

```go
func (p *Plugin) Execute(ctx context.Context, session task.Session, tsk *task.Task, res *task.Result) error
```

Execute adds some special details to the context.

<a name="Plugin.GRPCClient"></a>
### func \(\*Plugin\) [GRPCClient](<server.go#L88-L92>)

```go
func (*Plugin) GRPCClient(context.Context, *goplugin.GRPCBroker, *grpc.ClientConn) (any, error)
```

GRPCClient is unsupported.

<a name="Plugin.GRPCServer"></a>
### func \(\*Plugin\) [GRPCServer](<server.go#L81>)

```go
func (p *Plugin) GRPCServer(_ *goplugin.GRPCBroker, server *grpc.Server) error
```

GRPCServer calls \[rpc.RegisterGRPCServer\] for the plugin.

<a name="Plugin.Name"></a>
### func \(\*Plugin\) [Name](<server.go#L61>)

```go
func (p *Plugin) Name() string
```

Name returns the plugin's name.

<a name="Plugin.Serve"></a>
### func \(\*Plugin\) [Serve](<server.go#L71>)

```go
func (p *Plugin) Serve()
```

Serve starts the plugin gRPC server.

<a name="Plugin.ServeTest"></a>
### func \(\*Plugin\) [ServeTest](<testing.go#L19>)

```go
func (plugin *Plugin) ServeTest(t *testing.T) executor.Executor
```

ServeTest sets up a test gRPC connection which serves plugin and returns a client executor.

<a name="PluginClient"></a>
## type [PluginClient](<client.go#L28-L32>)

PluginClient manages a \[goplugin.Client\] and exposes it as a \[executor.Executor\].

```go
type PluginClient struct {
    executor.Executor
    // contains filtered or unexported fields
}
```

<a name="NewPluginClient"></a>
### func [NewPluginClient](<client.go#L37>)

```go
func NewPluginClient(ctx context.Context, goCmdPath string) (*PluginClient, error)
```

NewPluginClient starts a plugin subprocess and opens a gRPC connection to it.

<a name="PluginClient.Shutdown"></a>
### func \(\*PluginClient\) [Shutdown](<client.go#L71>)

```go
func (plugin *PluginClient) Shutdown()
```

Shutdown kills the subprocess.

<a name="PluginClientManager"></a>
## type [PluginClientManager](<client_manager.go#L18-L27>)

PluginClientManager manages a set of \[PluginClient\]s and functions as a distributing \[router.Router\].

```go
type PluginClientManager interface {
    executor.Executor

    // NOTE(colden): these should eventually be moved out of here
    RegisterExecutor(name string, exec executor.Executor) error
    UnregisterExecutors(names ...string)

    StartPlugins(ctx context.Context, plugins ...string) error
    Shutdown(ctx context.Context)
}
```

<a name="NewPluginClientManager"></a>
### func [NewPluginClientManager](<client_manager.go#L36>)

```go
func NewPluginClientManager() PluginClientManager
```

NewPluginClientManager creates a new empty [PluginClientManager](<#PluginClientManager>).

<a name="PluginOption"></a>
## type [PluginOption](<server.go#L41>)

PluginOption is a modifier for the plugin.

```go
type PluginOption func(plugin *Plugin) error
```

<a name="WithExecutor"></a>
### func [WithExecutor](<server.go#L64>)

```go
func WithExecutor[Params any](name string, exec argconv.TypedExecutor[Params]) PluginOption
```

WithExecutor registers an executor with the plugin.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
